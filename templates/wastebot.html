<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WasteWise - AI Bot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <style>
        /* Main Section Styling */
        .bot-main {
            min-height: 85vh;
            padding: 30px 20px;
            display: flex;
            justify-content: center;
        }

        /* Chat Container */
        .chat-container {
            width: 100%;
            max-width: 700px;
            background-color: #1a1a1a;
            border: 1px solid #4caf50;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background-color: #2e7d32;
            color: #fff;
            padding: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Chat Messages Area */
        #chat-window {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 600px;
            /* Scrollbar styling from style.css should apply */
        }

        .message {
            margin-bottom: 15px;
            display: flex;
        }

        .user-message {
            justify-content: flex-end;
        }

        .bot-message {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px;
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            white-space: pre-wrap; /* Preserve formatting from the AI response */
        }

        .user-message .message-bubble {
            background-color: #4caf50;
            color: #0a0e0a;
            border-bottom-right-radius: 5px;
        }

        .bot-message .message-bubble {
            background-color: #121212;
            color: #e0e0e0;
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-bottom-left-radius: 5px;
        }

        /* Input Form */
        #chat-form {
            display: flex;
            padding: 15px;
            border-top: 1px solid #2e7d32;
        }

        #user-input {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid #4caf50;
            border-radius: 25px;
            background-color: #0a0e0a;
            color: #fff;
            margin-right: 10px;
            font-family: inherit;
        }

        #send-btn {
            background-color: #4caf50;
            color: #0a0e0a;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
        }

        #send-btn:hover {
            background-color: #66bb6a;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none; /* Hidden by default */
            margin-left: 10px;
            font-style: italic;
            color: #ccc;
        }

        .typing-indicator.visible {
            display: block;
        }
        /* Navigation Bar - Optimized Flex Layout */
.navbar {
    background: rgba(5, 8, 5, 0.85);
    backdrop-filter: blur(20px);
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid rgba(76, 175, 80, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7), 0 0 50px rgba(76, 175, 80, 0.1);
}

.nav-glow-line {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(to right, transparent, #4caf50, transparent);
    animation: glow-line-pulse 4s infinite ease-in-out;
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px; /* Add gap between sections */
}

.logo {
    display: flex;
    align-items: center;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: #4caf50;
    text-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
    flex-shrink: 0; /* Prevents logo from shrinking */
}

.logo-svg {
    width: 30px;
    height: 30px;
    margin-right: 8px;
}

/* Central Links Container */
.nav-links-container {
    display: flex;
    gap: 15px; /* Spacing between links */
    flex-grow: 1; /* Allows it to take up available space */
    justify-content: center; /* Center the links */
}

.nav-link {
    color: #e0e0e0;
    text-decoration: none;
    padding: 0.6rem 1rem;
    border-radius: 5px;
    transition: color 0.3s, background-color 0.3s, border-bottom 0.3s;
    font-weight: 500;
}

.nav-link:hover, .nav-link.active {
    color: #4caf50;
    background-color: rgba(76, 175, 80, 0.1);
    border-bottom: 2px solid #4caf50;
}

.nav-link.active {
    font-weight: 700;
}

.nav-cta {
    flex-shrink: 0; /* Prevents button area from shrinking */
}

/* Button Styling (Assuming this is already in style.css, ensure it's clean) */
.btn {
    padding: 10px 20px;
    border-radius: 5px;
    text-decoration: none;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.1s;
    border: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.btn-primary {
    background-color: #4caf50;
    color: #0a0e0a;
}

.btn-primary:hover {
    background-color: #66bb6a;
    transform: translateY(-1px);
}

/* --- Responsive Adjustments --- */
@media (max-width: 900px) {
    /* Stack navigation items for better mobile view */
    .nav-container {
        flex-direction: column;
        align-items: stretch;
        padding: 15px 20px;
    }

    .nav-links-container {
        flex-direction: column;
        align-items: center;
        width: 100%;
        margin: 10px 0;
        gap: 5px; /* Tighter gap for stacked links */
    }

    .nav-link {
        width: 100%;
        text-align: center;
        padding: 10px 0;
    }
    
    .nav-cta {
        width: 100%;
        margin-top: 10px;
    }
    
    .btn {
        width: 100%;
    }
}
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-glow-line"></div>
        <div class="nav-container">
            <div class="logo">
                <!-- <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"> -->
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4caf50;stop-opacity:1"/>
                            <stop offset="100%" style="stop-color:#2e7d32;stop-opacity:1"/>
                        </linearGradient>
                    </defs>
                    <path d="M50 10 L65 25 L60 25 L60 45 L70 45 L70 40 L85 55 L70 70 L70 65 L60 65 L60 85 L65 85 L50 100 L35 85 L40 85 L40 65 L30 65 L30 70 L15 55 L30 40 L30 45 L40 45 L40 25 L35 25 Z" 
                          fill="url(#logoGradient)"/>
                </svg>
                WasteWise
            </div>
            <div class="nav-links-container">
                <a href="{{ url_for('home') }}" class="nav-link">Home</a>
                <a href="/marketplace" class="nav-link">Marketplace</a>
                <a href="/complain" class="nav-link">Report Issue</a>
                <a href="/library" class="nav-link">Library</a>
                <a href="/wastebot" class="nav-link active">WasteBot</a>
            </div>
            <div class="nav-cta">
                <button class="btn btn-primary">Sign In</button>
            </div>
        </div>
    </nav>

    <main class="bot-main">
        <div class="chat-container">
            <div class="chat-header">
                ðŸ¤– WasteWise Bot
            </div>
            <div id="chat-window">
                <div class="message bot-message">
                    <div class="message-bubble">
                        Hello! I'm the WasteWise Bot. I can help you with waste sorting, recycling rules, and sustainability facts. What can I tell you?
                    </div>
                </div>
                </div>

            <form id="chat-form">
                <input type="text" id="user-input" placeholder="Ask me about recycling..." required>
                <button type="submit" id="send-btn">Send</button>
            </form>
            <div class="typing-indicator" style="padding: 0 20px 10px;">Bot is thinking...</div>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer-content">
            <div class="footer-section">
                <h3>WasteWise</h3>
                <p>Transforming waste management through innovation and community collaboration.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="/marketplace">Marketplace</a></li>
                    <li><a href="/wastebot">WasteWise Bot</a></li>
                    <li><a href="/complain">Report Issue</a></li>
                    <li><a href="/library">Library</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Contact</h4>
                <p>Email: support@wastewise.com</p>
                <p>Phone: +91 123 456 7890</p>
            </div>
        </div>
    </footer>
    
    <script>
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const typingIndicator = document.querySelector('.typing-indicator');

        // Function to scroll to the bottom of the chat window
        function scrollToBottom() {
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // Function to add a message to the chat window
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', `${sender}-message`);
            
            const bubble = document.createElement('div');
            bubble.classList.add('message-bubble');
            bubble.innerText = text; // Use innerText to correctly display the AI's text
            
            messageDiv.appendChild(bubble);
            chatWindow.appendChild(messageDiv);
            scrollToBottom();
        }

        chatForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            const message = userInput.value.trim();

            if (!message) return;

            // 1. Display user message
            addMessage(message, 'user');
            userInput.value = ''; // Clear input

            // 2. Show typing indicator
            typingIndicator.classList.add('visible');
            scrollToBottom();

            try {
                // 3. Send message to Flask backend
                const response = await fetch('/api/wastebot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: message })
                });

                const data = await response.json();

                // 4. Display bot response
                if (data.response) {
                    addMessage(data.response, 'bot');
                } else if (data.error) {
                    addMessage(`Error: ${data.error}`, 'bot');
                }

            } catch (error) {
                console.error('Fetch error:', error);
                addMessage('Sorry, the bot is currently unavailable. Please try again later.', 'bot');
            } finally {
                // 5. Hide typing indicator
                typingIndicator.classList.remove('visible');
            }
        });

        document.addEventListener('DOMContentLoaded', scrollToBottom);
    </script>
</body>
</html>